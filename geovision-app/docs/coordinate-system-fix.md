# Исправление координатной системы для геологических разрезов

## 🐛 Проблема
```
"Конечная точка (5137, 3029) выходит за границы карты 4454x4549"
```

**Неправильная логика координат:**
- Пользователь выбрал: (1464, 314) → (2751, 2252) 
- На бэкенд отправилось: (5137, 3029) ← Выходит за границы!

## 🔍 Причина  
**Неверная координатная система**

```javascript
// ❌ НЕПРАВИЛЬНО - добавляли смещение области карты
const absoluteStartX = areas.map.x + startPoint.x  // 3673 + 1464 = 5137
const absoluteStartY = areas.map.y + startPoint.y  // 777 + 2252 = 3029
```

**Проблема:** Мы отправляем **обрезанную карту** на бэкенд, поэтому координаты должны быть **относительно обрезанной карты**, а не исходного изображения.

## ✅ Правильная логика

### Workflow координат:
1. **Пользователь** выбирает точки на **обрезанной карте**: (1464, 314)
2. **Бэкенд** получает **обрезанную карту** как файл  
3. **Координаты** должны быть **относительно обрезанной карты**: (1464, 314)
4. **НЕ нужно** добавлять смещение исходной области

### Исправленный код:
```javascript  
// ✅ ПРАВИЛЬНО - координаты относительно обрезанной карты
const mapStartX = Math.round(startPoint.x)  // 1464
const mapStartY = Math.round(startPoint.y)  // 314  
const mapEndX = Math.round(endPoint.x)      // 2751
const mapEndY = Math.round(endPoint.y)      // 2252
```

## 📊 Схема координатных систем

### Исходное изображение (4454x4549):
```
┌─────────────────────────────────────┐
│                                     │
│     ┌─────────┐ ← Область карты     │  
│     │ (1464,  │   (areas.map)       │
│     │  314)   │                     │
│     │    ●────────● (2751, 2252)    │
│     │         │                     │  
│     └─────────┘                     │
│                                     │
└─────────────────────────────────────┘
```

### Обрезанная карта (отправляется на бэкенд):  
```
┌─────────┐
│ (1464,  │
│  314)   │ 
│    ●────────● (2751, 2252)
│         │
└─────────┘
```

## 🎯 Результат
- ✅ Координаты остаются в пределах обрезанной карты
- ✅ Бэкенд корректно обрабатывает точки разреза  
- ✅ Ошибка "выходит за границы" исправлена
- ✅ Геологические разрезы создаются успешно

## 🧪 Тестирование
Теперь при выборе точек:
- **UI показывает**: (1464, 314) → (2751, 2252)
- **На бэкенд отправляется**: (1464, 314) → (2751, 2252) 
- **Результат**: ✅ В пределах обрезанной карты

Логика координат исправлена! 🎉